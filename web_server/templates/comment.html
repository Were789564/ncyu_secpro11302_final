<!DOCTYPE html>
<html>
<head>
    <title>ç•™è¨€æ¿ - SecureWeb</title>
</head>
<body>
    {% extends "base.html" %}

    {% block title %}ç•™è¨€æ¿ - SecureWeb{% endblock %}

    {% block content %}
    <div class="card" style="max-width: 800px;">
        <h2 style="text-align: center; margin-bottom: 2rem; color: #333;">ğŸ’¬ å…¬é–‹ç•™è¨€æ¿</h2>
        <p style="text-align: center; color: #666; margin-bottom: 2rem;">
            æ­¡è¿ <strong>{{ username }}</strong>ï¼åœ¨æ­¤åˆ†äº«æ‚¨çš„æƒ³æ³•ï¼Œæ‰€æœ‰ç”¨æˆ¶éƒ½å¯ä»¥çœ‹åˆ°æ‚¨çš„ç•™è¨€ã€‚
        </p>
        
        <form method="POST" style="margin-bottom: 2rem;">
            <div class="form-group">
                <label for="message">ç•™è¨€å…§å®¹</label>
                <textarea id="message" name="message" rows="4" 
                         placeholder="åˆ†äº«æ‚¨çš„æƒ³æ³•ã€é€£çµã€æˆ–ä»»ä½•å…§å®¹..." required></textarea>
                <small style="color: #666;">æ”¯æ´ HTML æ ¼å¼ï¼Œè®“æ‚¨çš„ç•™è¨€æ›´è±å¯Œï¼ç•™è¨€å°‡æ°¸ä¹…ä¿å­˜åœ¨è³‡æ–™åº«ä¸­ã€‚</small>
            </div>
            
            <button type="submit" class="btn">ç™¼å¸ƒç•™è¨€</button>
        </form>
        
        <div style="background: #e3f2fd; padding: 1rem; border-radius: 10px; margin-bottom: 2rem;">
            <h4 style="color: #1976d2; margin-bottom: 0.5rem;">ğŸ”’ å®‰å…¨æé†’</h4>
            <p style="color: #333; font-size: 0.9rem;">
                æ­¤ç•™è¨€æ¿æ”¯æ´ HTML å…§å®¹ä»¥æä¾›æ›´å¥½çš„ä½¿ç”¨é«”é©—ã€‚æ‰€æœ‰ç•™è¨€å’Œç”¨æˆ¶è³‡æ–™éƒ½æœƒæ°¸ä¹…ä¿å­˜åœ¨è³‡æ–™åº«ä¸­ã€‚
            </p>
        </div>
        
        <h3 style="color: #333; margin-bottom: 1rem;">
            ğŸ“ æ‰€æœ‰ç•™è¨€ <span style="font-size: 0.8rem; color: #666;">({{ comments|length }} å‰‡ç•™è¨€)</span>
            {% if username == 'admin' %}
                <br>
                <small>
                    <a href="/admin/comments" style="color: #007bff; text-decoration: none;">[æŸ¥çœ‹ç•™è¨€è³‡æ–™åº«]</a> | 
                    <a href="/admin/users" style="color: #007bff; text-decoration: none;">[æŸ¥çœ‹ç”¨æˆ¶è³‡æ–™åº«]</a>
                </small>
            {% endif %}
        </h3>
        
        {% if comments %}
            {% for comment in comments %}
                <div class="comment-item">
                    <div class="comment-user">
                        ğŸ‘¤ {{ comment.username }} 
                        <span style="font-size: 0.8rem; color: #888; font-weight: normal;">
                            - {{ comment.created_at }}
                        </span>
                    </div>
                    <!-- æ•…æ„çš„ Stored XSS æ¼æ´ï¼šå¾è³‡æ–™åº«è®€å–æœªéæ¿¾çš„ HTML å…§å®¹ -->
                    <div style="margin-top: 0.5rem; line-height: 1.5;">
                        {{ comment.message|safe }}
                    </div>
                </div>
            {% endfor %}
        {% else %}
            <div style="text-align: center; padding: 2rem; color: #666; background: #f8f9fa; border-radius: 10px;">
                <p>ğŸ“­ ç›®å‰æ²’æœ‰ç•™è¨€</p>
                <p style="font-size: 0.9rem; margin-top: 0.5rem;">æˆç‚ºç¬¬ä¸€å€‹ç™¼å¸ƒç•™è¨€çš„ç”¨æˆ¶å§ï¼</p>
            </div>
        {% endif %}
        
        <div style="margin-top: 2rem; padding: 1rem; background: #fff3cd; border-radius: 10px; border-left: 4px solid #ffc107;">
            <h4 style="color: #856404; margin-bottom: 0.5rem;">âš ï¸ Stored XSS èªªæ˜</h4>
            <p style="color: #856404; font-size: 0.9rem;">
                æ­¤ç•™è¨€æ¿æœ‰ Stored XSS æ¼æ´ï¼Œä»¥ä¸‹æ˜¯é æœŸdemoçš„å…§å®¹ã€‚
            </p>
            <ul style="color: #856404; font-size: 0.9rem; margin-top: 0.5rem; padding-left: 1.5rem;">
                <li>åˆ©ç”¨XSSè®“ä½¿ç”¨è€…æŠŠè‡ªå·±çš„CSRF tokenä¸€èµ·å¸¶é€²å»ï¼Œç„¶å¾ŒæŠŠå¯†ç¢¼çµ¦æ”¹æ‰</li>
                <li>ç”¨JShellå·¥å…·è®“æ”»æ“Šè€…å¯ä»¥æ“ä½œWeb Shell (KeyLoggerã€é‡æ–°å®šå‘)</li>
            </ul>
        </div>
    </div>

    <script>
    // æ·»åŠ ä¸€äº› JavaScript ä¾†å¢å¼·æ¼”ç¤ºæ•ˆæœ
    document.addEventListener('DOMContentLoaded', function() {
        // é«˜äº®é¡¯ç¤ºå¯èƒ½çš„è…³æœ¬æ¨™ç±¤ï¼ˆç”¨æ–¼æ•™å­¸ï¼‰
        const comments = document.querySelectorAll('.comment-item div:last-child');
        comments.forEach(comment => {
            if (comment.innerHTML.includes('<script>') || comment.innerHTML.includes('<img') || comment.innerHTML.includes('<svg')) {
                comment.style.border = '2px dashed #e74c3c';
                comment.style.padding = '0.5rem';
                comment.style.marginTop = '0.5rem';
                comment.style.backgroundColor = '#ffeaea';
                
                // æ·»åŠ è­¦å‘Šæ¨™ç±¤
                const warning = document.createElement('small');
                warning.innerHTML = 'âš ï¸ æ­¤ç•™è¨€åŒ…å«å¯èƒ½çš„æƒ¡æ„è…³æœ¬';
                warning.style.color = '#e74c3c';
                warning.style.fontWeight = 'bold';
                warning.style.display = 'block';
                warning.style.marginBottom = '0.5rem';
                comment.insertBefore(warning, comment.firstChild);
            }
        });
    });
    </script>
    {% endblock %}
</body>
</html>
